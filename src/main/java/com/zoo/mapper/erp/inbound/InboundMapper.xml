<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zoo.mapper.erp.inbound.InboundMapper">
	<resultMap type="com.zoo.model.erp.inbound.Inbound" id="BaseResultMap">
		<id column="id" property="id"/>
		<id column="foreignKey" property="foreignKey"/>
		<association column="foreignKey"   property="splitDetail" select="com.zoo.mapper.erp.productsplit.ProductSplitDetailMapper.getDetailById"></association>
		<collection column="id" property="details" select="com.zoo.mapper.erp.inbound.InboundDetailMapper.getDetailByInboundId"></collection>
	</resultMap>
	<insert id="addInbound">
		insert into inbound (
			id,
			code,
			foreignKey,
			cuserId,
			warehouseId,
			ctime,
			type,
			costId
		)values(
			#{inbound.id},
			#{inbound.code},
			#{inbound.foreignKey},
			#{inbound.cuserId},
			#{inbound.warehouse.id},
			#{inbound.ctime},
			#{inbound.type},
			#{inbound.cost.id}
		)
	</insert>
	<select id="getInboundByPage" resultType="java.util.HashMap">
		select i.code code, i.ctime ctime, ps.name from 
		inbound i left join 
		(select p.id id, s.supplierName name from purchase p left join supplier s on p.supplierId = s.id) ps 
		on i.foreignKey = ps.id order by ctime desc 
		<if test="start != null and size != null">
			limit #{start}, #{size}
		</if>
	</select>
	<select id="getTotleCount" resultType="long">
		select count(*) count from 
		inbound i left join 
		(select p.id id, s.supplierName name from purchase p left join supplier s on p.supplierId = s.id) ps 
		on i.foreignKey = ps.id
	</select>
	<select id="getInboundByForeignKey" resultMap="BaseResultMap">
		select * from inbound where foreignKey=#{foreignKey}
	</select>
	<delete id="deleteInboundByForeignKey">
		delete from inbound where foreignKey=#{foreignKey}
	</delete>
</mapper>